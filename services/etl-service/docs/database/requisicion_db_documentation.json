{
  "database_metadata": {
    "business_domain": "Sistema de gestión de requisiciones empresariales multi-tenant",
    "industry_context": "Gestión de compras, procesos de aprobación y control financiero empresarial",
    "data_classification": "Operacional, transaccional y de gestión empresarial",
    "update_frequency": "Tiempo real - transaccional con alta frecuencia",
    "business_processes": [
      "Creación y gestión de requisiciones",
      "Flujos de aprobación por departamento",
      "Integración con sistemas ERP",
      "Control de presupuestos y costos",
      "Gestión de proveedores y productos",
      "Auditoría y trazabilidad de transacciones"
    ],
    "data_flow": "Usuario crea requisición → Validación departamental → Flujo de aprobaciones → Integración ERP → Orden de compra → Entrega y facturación",
    "primary_business_value": "Automatización completa del proceso de compras empresariales con control financiero y trazabilidad",
    "ai_application_areas": [
      "Predicción de necesidades de compra",
      "Optimización de flujos de aprobación",
      "Análisis de patrones de gasto",
      "Detección de anomalías en requisiciones",
      "Recomendación de proveedores",
      "Automatización de clasificación de productos"
    ]
  },
  
  "tables": {
    "requisition": {
      "business_purpose": "Tabla principal que contiene todas las solicitudes de compra empresariales con información completa del flujo de aprobación, montos, fechas y estado actual",
      "critical_fields": {
        "number": "Número único de requisición por empresa - CRÍTICO para trazabilidad y referencia en auditorías",
        "state": "Estado actual del flujo de aprobación - CRÍTICO para IA de optimización de procesos y predicción de tiempos",
        "comments": "Comentarios y justificación de la requisición - CRÍTICO para IA de análisis de texto y clasificación automática",
        "internal_note": "Notas internas privadas - CRÍTICO para entrenamiento de modelos de gestión interna",
        "total": "Monto total de la requisición - CRÍTICO para IA predictiva de presupuestos y análisis financiero",
        "priority": "Prioridad de la requisición - CRÍTICO para IA de optimización de flujos de trabajo",
        "rejection_reason": "Motivo de rechazo detallado - CRÍTICO para IA de mejora de procesos y prevención de rechazos"
      },
      "ai_usage": {
        "prediction_input": ["total", "department_id", "project_id", "priority", "required_date", "state"],
        "training_data": ["comments", "rejection_reason", "state", "priority", "total"],
        "metadata_source": ["number", "date", "company_id", "user_id", "approved_by_user_id"],
        "kb_value": "CRÍTICO: Contiene el núcleo del proceso de negocio - decisiones de aprobación, justificaciones, patrones de gasto, y flujos de trabajo reales"
      },
      "relationships": {
        "requisition.company_id": "company.id (INNER JOIN crítico para multi-tenancy)",
        "requisition.department_id": "department.id (INNER JOIN para análisis departamental)",
        "requisition.user_id": "user.id (INNER JOIN para análisis de usuario creador)",
        "requisition.project_id": "project.id (LEFT JOIN para análisis por proyecto)",
        "requisition.supplier_id": "supplier.id (LEFT JOIN para análisis de proveedores)",
        "requisition.approved_by_user_id": "user.id (LEFT JOIN para análisis de aprobadores)"
      },
      "business_rules": [
        "Solo usuarios del mismo departamento pueden crear requisiciones para ese departamento",
        "El estado sigue un flujo secuencial: draft → sentForApproval → approved/rejected",
        "Una vez aprobada, solo se puede cancelar con permisos especiales",
        "El total debe coincidir con la suma de los items"
      ]
    },
    
    "requisition_item": {
      "business_purpose": "Detalle línea por línea de productos/servicios solicitados en cada requisición con precios, cantidades y especificaciones técnicas",
      "critical_fields": {
        "description": "Descripción detallada del producto/servicio - CRÍTICO para IA de clasificación automática y matching con catálogos",
        "quantity": "Cantidad solicitada - CRÍTICO para IA predictiva de inventarios y análisis de consumo",
        "unit_price": "Precio unitario - CRÍTICO para IA de análisis de precios y detección de anomalías",
        "notes": "Especificaciones técnicas adicionales - CRÍTICO para entrenamiento de modelos de productos especializados",
        "unit": "Unidad de medida - CRÍTICO para normalización y análisis comparativo"
      },
      "ai_usage": {
        "prediction_input": ["quantity", "unit_price", "product_id"],
        "training_data": ["description", "notes", "unit", "quantity"],
        "metadata_source": ["requisition_id", "product_id"],
        "kb_value": "CRÍTICO: Especificaciones técnicas detalladas y patrones de compra reales por producto/servicio"
      },
      "relationships": {
        "requisition_item.requisition_id": "requisition.id (INNER JOIN crítico para integridad)",
        "requisition_item.product_id": "product.id (LEFT JOIN para análisis de productos)"
      }
    },
    
    "company": {
      "business_purpose": "Entidad principal multi-tenant que define cada empresa/organización usando el sistema con su configuración específica",
      "critical_fields": {
        "tax_id": "Identificación fiscal única - CRÍTICO para integraciones ERP y compliance",
        "legal_name": "Razón social oficial - CRÍTICO para documentos legales y integraciones",
        "base_currency_code": "Moneda base de operación - CRÍTICO para conversiones y análisis financiero",
        "config_json": "Configuración específica de la empresa - CRÍTICO para personalización de flujos de trabajo"
      },
      "ai_usage": {
        "prediction_input": ["base_currency_code", "country_code"],
        "training_data": ["config_json"],
        "metadata_source": ["id", "tax_id", "legal_name"],
        "kb_value": "ALTO: Configuraciones empresariales y patrones de uso por industria/región"
      }
    },
    
    "user": {
      "business_purpose": "Usuarios del sistema con roles, permisos y información de contacto para gestión de accesos y flujos de aprobación",
      "critical_fields": {
        "role": "Rol del usuario en el sistema - CRÍTICO para IA de asignación automática de aprobadores",
        "status": "Estado activo/inactivo - CRÍTICO para validación de flujos de trabajo",
        "permissions_json": "Permisos específicos del usuario - CRÍTICO para automatización de accesos"
      },
      "ai_usage": {
        "prediction_input": ["role", "department_id", "status"],
        "training_data": ["permissions_json", "role"],
        "metadata_source": ["id", "email", "name", "company_id"],
        "kb_value": "MEDIO: Patrones de uso y comportamiento de usuarios por rol"
      }
    },
    
    "supplier": {
      "business_purpose": "Catálogo de proveedores con información comercial, fiscal y de rendimiento para selección automática y análisis",
      "critical_fields": {
        "legal_name": "Razón social del proveedor - CRÍTICO para matching automático y validaciones legales",
        "tax_id": "Identificación fiscal - CRÍTICO para integraciones ERP y validaciones",
        "rating": "Calificación promedio del proveedor - CRÍTICO para IA de recomendación de proveedores",
        "payment_terms": "Términos de pago - CRÍTICO para análisis de flujo de caja y negociación",
        "category": "Categoría del proveedor - CRÍTICO para clasificación automática y matching"
      },
      "ai_usage": {
        "prediction_input": ["rating", "category", "payment_terms", "country_code"],
        "training_data": ["category", "payment_terms", "rating"],
        "metadata_source": ["id", "tax_id", "legal_name"],
        "kb_value": "ALTO: Rendimiento histórico de proveedores y patrones de selección"
      }
    },
    
    "product": {
      "business_purpose": "Catálogo maestro de productos y servicios con especificaciones, precios y datos de sincronización ERP",
      "critical_fields": {
        "description": "Descripción técnica completa - CRÍTICO para IA de matching automático y clasificación",
        "sku": "Código único del producto - CRÍTICO para trazabilidad e integraciones",
        "list_price": "Precio de lista oficial - CRÍTICO para análisis de variaciones de precio",
        "category": "Categoría del producto - CRÍTICO para IA de clasificación automática",
        "external_id": "ID en sistema ERP externo - CRÍTICO para sincronización"
      },
      "ai_usage": {
        "prediction_input": ["list_price", "category", "supplier_id"],
        "training_data": ["description", "category", "name"],
        "metadata_source": ["id", "sku", "external_id"],
        "kb_value": "CRÍTICO: Especificaciones técnicas y patrones de uso de productos"
      }
    },
    
    "department": {
      "business_purpose": "Estructura organizacional empresarial para control presupuestario y flujos de aprobación departamentales",
      "critical_fields": {
        "name": "Nombre del departamento - CRÍTICO para análisis organizacional",
        "description": "Descripción y función del departamento - CRÍTICO para IA de asignación automática"
      },
      "ai_usage": {
        "prediction_input": ["id", "company_id"],
        "training_data": ["name", "description"],
        "metadata_source": ["id", "name", "company_id"],
        "kb_value": "MEDIO: Patrones de gasto y comportamiento por departamento"
      }
    },
    
    "project": {
      "business_purpose": "Proyectos empresariales para asignación de costos y seguimiento presupuestario específico",
      "critical_fields": {
        "name": "Nombre del proyecto - CRÍTICO para análisis de costos por proyecto",
        "description": "Descripción detallada del proyecto - CRÍTICO para IA de clasificación",
        "status": "Estado del proyecto - CRÍTICO para validación de requisiciones"
      },
      "ai_usage": {
        "prediction_input": ["status", "department_id"],
        "training_data": ["description", "name"],
        "metadata_source": ["id", "name", "company_id"],
        "kb_value": "ALTO: Patrones de gasto y gestión de presupuestos por proyecto"
      }
    },
    
    "audit_log": {
      "business_purpose": "Registro completo de auditoría con todas las acciones del sistema para compliance y análisis de comportamiento",
      "critical_fields": {
        "action": "Acción realizada - CRÍTICO para análisis de patrones de uso",
        "entity": "Entidad afectada - CRÍTICO para trazabilidad",
        "details_json": "Detalles completos de la acción - CRÍTICO para análisis forense y aprendizaje"
      },
      "ai_usage": {
        "prediction_input": ["action", "entity", "user_id"],
        "training_data": ["details_json", "action"],
        "metadata_source": ["id", "entity_id", "created_at"],
        "kb_value": "CRÍTICO: Comportamientos reales de usuarios y patrones de actividad del sistema"
      }
    },
    
    "erp_integration": {
      "business_purpose": "Configuración de integraciones con sistemas ERP externos para sincronización automática de datos maestros",
      "critical_fields": {
        "status": "Estado de la integración - CRÍTICO para monitoreo automático",
        "last_sync_at": "Última sincronización exitosa - CRÍTICO para alertas automáticas",
        "config_json": "Configuración de mapeo de campos - CRÍTICO para sincronización"
      },
      "ai_usage": {
        "prediction_input": ["status", "last_sync_at"],
        "training_data": ["config_json"],
        "metadata_source": ["id", "company_id"],
        "kb_value": "MEDIO: Patrones de integración y configuraciones exitosas"
      }
    },
    
    "digital_signature": {
      "business_purpose": "Firmas digitales para validación legal de aprobaciones con trazabilidad completa del proceso",
      "critical_fields": {
        "method": "Método de firma utilizado - CRÍTICO para validación legal",
        "status": "Estado de la firma - CRÍTICO para validez legal",
        "code_hash": "Hash del código de verificación - CRÍTICO para seguridad"
      },
      "ai_usage": {
        "prediction_input": ["method", "status"],
        "training_data": ["method", "attempts"],
        "metadata_source": ["id", "requisition_id", "user_id"],
        "kb_value": "MEDIO: Patrones de seguridad y métodos de autenticación"
      }
    },
    
    "approval_rule": {
      "business_purpose": "Reglas de negocio configurables para flujos de aprobación automática basadas en condiciones específicas",
      "critical_fields": {
        "applies_to": "Tipo de condición que activa la regla - CRÍTICO para automatización de flujos",
        "expression_json": "Condiciones lógicas complejas en JSON - CRÍTICO para IA de evaluación automática",
        "enforce_json": "Acciones a ejecutar cuando se cumple la condición - CRÍTICO para automatización",
        "priority": "Prioridad de evaluación de la regla - CRÍTICO para orden de procesamiento"
      },
      "ai_usage": {
        "prediction_input": ["applies_to", "priority"],
        "training_data": ["expression_json", "enforce_json"],
        "metadata_source": ["id", "policy_id"],
        "kb_value": "CRÍTICO: Lógica de negocio real y patrones de aprobación para automatización inteligente"
      },
      "relationships": {
        "approval_rule.policy_id": "approval_policy.id (INNER JOIN para contexto de política)"
      }
    },
    
    "erp_catalog": {
      "business_purpose": "Catálogo maestro de sistemas ERP disponibles para integración con esquemas de configuración específicos",
      "critical_fields": {
        "code": "Código único identificador del ERP - CRÍTICO para integraciones",
        "default_config_schema": "Esquema JSON de configuración - CRÍTICO para IA de configuración automática",
        "supported_entities": "Lista de entidades que soporta el ERP - CRÍTICO para mapeo automático",
        "features_json": "Características específicas del ERP - CRÍTICO para selección automática"
      },
      "ai_usage": {
        "prediction_input": ["code", "supported_entities", "active"],
        "training_data": ["default_config_schema", "features_json"],
        "metadata_source": ["id", "name", "vendor"],
        "kb_value": "ALTO: Configuraciones exitosas de ERP y patrones de integración por industria"
      }
    },
    
    "cost_center": {
      "business_purpose": "Centros de costo empresariales para asignación y control presupuestario granular por área de negocio",
      "critical_fields": {
        "code": "Código único del centro de costo - CRÍTICO para reporting financiero",
        "name": "Nombre descriptivo del centro - CRÍTICO para análisis organizacional",
        "attributes_json": "Atributos específicos en JSON - CRÍTICO para análisis financiero personalizado"
      },
      "ai_usage": {
        "prediction_input": ["company_id", "active"],
        "training_data": ["attributes_json", "name"],
        "metadata_source": ["id", "code", "company_id"],
        "kb_value": "ALTO: Patrones de asignación de costos y comportamiento presupuestario por área"
      }
    },
    
    "product_category": {
      "business_purpose": "Taxonomía jerárquica de categorías de productos con soporte para mapeo de sistemas ERP externos",
      "critical_fields": {
        "path": "Ruta jerárquica completa - CRÍTICO para clasificación automática",
        "full_path": "Ruta textual completa - CRÍTICO para IA de clasificación de texto",
        "external_source": "Sistema ERP origen - CRÍTICO para sincronización",
        "external_id": "ID en sistema externo - CRÍTICO para mapeo automático"
      },
      "ai_usage": {
        "prediction_input": ["path_depth", "parent_id", "company_id"],
        "training_data": ["name", "full_path", "path"],
        "metadata_source": ["id", "code", "external_id"],
        "kb_value": "CRÍTICO: Taxonomías empresariales reales y patrones de clasificación de productos"
      },
      "relationships": {
        "product_category.parent_id": "product_category.id (SELF JOIN para jerarquía)",
        "product_category.company_id": "company.id (INNER JOIN para multi-tenancy)"
      }
    },
    
    "requisition_attachment": {
      "business_purpose": "Archivos adjuntos a requisiciones con metadatos de seguridad y validación antivirus",
      "critical_fields": {
        "filename": "Nombre original del archivo - CRÍTICO para trazabilidad",
        "content_type": "Tipo MIME del archivo - CRÍTICO para validación de seguridad",
        "antivirus_status": "Estado del escaneo antivirus - CRÍTICO para seguridad del sistema",
        "size_bytes": "Tamaño del archivo - CRÍTICO para análisis de uso de almacenamiento"
      },
      "ai_usage": {
        "prediction_input": ["content_type", "size_bytes"],
        "training_data": ["filename", "antivirus_status"],
        "metadata_source": ["id", "requisition_id", "uploaded_by_user_id"],
        "kb_value": "MEDIO: Patrones de documentación y tipos de archivos por proceso de negocio"
      }
    },
    
    "currency": {
      "business_purpose": "Catálogo global de monedas soportadas con configuración de decimales para conversiones precisas",
      "critical_fields": {
        "code": "Código ISO de moneda - CRÍTICO para integraciones financieras",
        "decimals": "Número de decimales para la moneda - CRÍTICO para cálculos precisos",
        "name": "Nombre de la moneda - CRÍTICO para presentación al usuario"
      },
      "ai_usage": {
        "prediction_input": ["code", "active"],
        "training_data": ["name"],
        "metadata_source": ["code"],
        "kb_value": "BAJO: Datos maestros estándar de configuración"
      }
    },
    
    "exchange_rate": {
      "business_purpose": "Tipos de cambio históricos para conversiones de moneda con trazabilidad temporal",
      "critical_fields": {
        "value": "Valor del tipo de cambio - CRÍTICO para conversiones financieras",
        "rate_date": "Fecha del tipo de cambio - CRÍTICO para precisión temporal",
        "base_currency_code": "Moneda base - CRÍTICO para conversiones",
        "quote_currency_code": "Moneda cotizada - CRÍTICO para conversiones"
      },
      "ai_usage": {
        "prediction_input": ["rate_date", "base_currency_code", "quote_currency_code"],
        "training_data": ["value"],
        "metadata_source": ["id", "rate_date"],
        "kb_value": "ALTO: Tendencias de tipos de cambio para predicción financiera"
      }
    }
  },

  "examples": {
    "requisition": [
      {
        "number": "REQ-2024-001234",
        "state": "approved",
        "comments": "Compra urgente de equipos de oficina para proyecto nuevo de expansión. Se requiere entrega en menos de 5 días hábiles.",
        "internal_note": "Presupuesto aprobado por gerencia, usar proveedor preferencial por velocidad de entrega",
        "total": 2500000.00,
        "priority": "high",
        "currency_code": "CLP"
      },
      {
        "number": "REQ-2024-002156",
        "state": "rejected",
        "comments": "Solicitud de mobiliario de oficina premium para área de gerencia",
        "rejection_reason": "Presupuesto excedido para Q4. Reevaluar en próximo período fiscal con opciones más económicas",
        "total": 8500000.00,
        "priority": "low",
        "currency_code": "CLP"
      }
    ],
    "requisition_item": [
      {
        "description": "Laptop HP EliteBook 14\" Intel i7 16GB RAM 512GB SSD Windows 11 Pro con software Office incluido",
        "quantity": 3.00,
        "unit_price": 850000.00,
        "unit": "unidad",
        "notes": "Especificar versión en español del sistema operativo. Garantía extendida de 3 años incluida."
      },
      {
        "description": "Material de oficina: Resmas de papel A4 75g, marca Navigator, paquete de 5 unidades",
        "quantity": 20.00,
        "unit_price": 15000.00,
        "unit": "paquete",
        "notes": "Material consumible estándar para área administrativa"
      }
    ],
    "supplier": [
      {
        "legal_name": "Tecnología Empresarial SpA",
        "tax_id": "76.123.456-7",
        "rating": 4.5,
        "payment_terms": "30 días",
        "category": "Tecnología y Equipos"
      },
      {
        "legal_name": "Distribuidora de Insumos Ltda",
        "tax_id": "96.789.123-4",
        "rating": 4.2,
        "payment_terms": "15 días",
        "category": "Material de Oficina"
      }
    ],
    "approval_rule": [
      {
        "applies_to": "amount_threshold",
        "priority": 100,
        "expression_json": {
          "condition": "AND",
          "rules": [
            {"field": "total", "operator": "greater_than", "value": 1000000},
            {"field": "department_id", "operator": "equals", "value": "finance"}
          ]
        },
        "enforce_json": {
          "required_approvers": 2,
          "approval_levels": ["department_manager", "finance_director"],
          "escalation_hours": 48
        }
      }
    ],
    "product_category": [
      {
        "name": "Tecnología",
        "path": "/technology",
        "full_path": "Tecnología",
        "path_depth": 1,
        "external_source": "laudus",
        "external_id": "TECH_001"
      },
      {
        "name": "Computadores",
        "path": "/technology/computers",
        "full_path": "Tecnología > Computadores",
        "path_depth": 2,
        "external_source": "laudus",
        "external_id": "TECH_COMP_001"
      }
    ],
    "erp_catalog": [
      {
        "code": "laudus",
        "name": "Laudus ERP",
        "vendor": "Laudus Software",
        "supported_entities": ["supplier", "product", "customer", "purchase_order"],
        "default_config_schema": {
          "credentials": {
            "username": "string",
            "password": "string", 
            "company_database": "string"
          },
          "sync_settings": {
            "auto_sync": "boolean",
            "sync_frequency": "daily"
          }
        },
        "features_json": ["real_time_sync", "batch_import", "custom_fields"]
      }
    ]
  },

  "key_business_insights": {
    "primary_workflow": "El sistema gestiona el ciclo completo desde creación de requisición hasta orden de compra, con énfasis en control de aprobaciones y trazabilidad",
    "compliance_requirements": "Auditoría completa, firmas digitales, y trazabilidad para cumplimiento normativo empresarial",
    "integration_complexity": "Alta integración con sistemas ERP externos requiere mapeo sofisticado de campos y sincronización bidireccional",
    "multi_tenant_considerations": "Aislamiento completo por empresa con configuraciones específicas por organización",
    "financial_controls": "Control estricto de presupuestos, tipos de cambio, y validaciones financieras por departamento/proyecto"
  },

  "common_queries": {
    "requisitions_by_status": {
      "description": "Requisiciones agrupadas por estado para dashboards ejecutivos",
      "frequency": "Muy Alta",
      "ai_value": "CRÍTICO para predicción de tiempos de aprobación",
      "tables_involved": ["requisition", "company", "department", "user"]
    },
    "spending_analysis_by_department": {
      "description": "Análisis de gasto por departamento y período",
      "frequency": "Alta",
      "ai_value": "CRÍTICO para predicción presupuestaria y detección de anomalías",
      "tables_involved": ["requisition", "requisition_item", "department", "project"]
    },
    "supplier_performance": {
      "description": "Rendimiento de proveedores basado en entregas y calificaciones",
      "frequency": "Media",
      "ai_value": "ALTO para recomendación automática de proveedores",
      "tables_involved": ["supplier", "requisition", "requisition_item"]
    },
    "approval_bottlenecks": {
      "description": "Identificación de cuellos de botella en procesos de aprobación",
      "frequency": "Media",
      "ai_value": "ALTO para optimización de flujos de trabajo",
      "tables_involved": ["requisition", "digital_signature", "approval_rule", "user"]
    },
    "product_demand_patterns": {
      "description": "Patrones de demanda de productos por temporada/departamento",
      "frequency": "Media",
      "ai_value": "CRÍTICO para predicción de inventarios y compras automáticas",
      "tables_involved": ["requisition_item", "product", "product_category", "department"]
    }
  },

  "technical_considerations": {
    "indexing_strategy": {
      "composite_indexes": [
        "(company_id, state, date) para filtros frecuentes de requisiciones",
        "(company_id, department_id, created_at) para análisis departamental",
        "(requisition_id, product_id) para análisis de items",
        "(company_id, external_source, external_id) para sincronización ERP"
      ],
      "full_text_indexes": [
        "requisition.comments para búsqueda de texto",
        "requisition_item.description para clasificación de productos",
        "product.description para matching automático"
      ]
    },
    "partitioning_recommendations": {
      "audit_log": "Particionado por fecha mensual para performance de consultas históricas",
      "exchange_rate": "Particionado por año para datos históricos extensos",
      "erp_sync_log": "Particionado por fecha para gestión de logs de sincronización"
    },
    "data_archival": {
      "requisition": "Soft delete con archival después de 7 años según política de retención",
      "audit_log": "Retención de 5 años con compresión después de 1 año",
      "erp_sync_log": "Retención de 2 años para troubleshooting"
    },
    "security_considerations": [
      "Encriptación a nivel de campo para credenciales ERP",
      "Auditoría obligatoria para todas las operaciones CRUD",
      "Aislamiento estricto multi-tenant por company_id",
      "Validación de firmas digitales para integridad legal"
    ]
  },

  "ai_optimization_opportunities": {
    "high_priority": [
      "Clasificación automática de productos basada en descripción",
      "Predicción de rechazos de requisiciones basada en patrones históricos",
      "Recomendación de proveedores según performance y categoría",
      "Optimización de flujos de aprobación basada en urgencia y monto"
    ],
    "medium_priority": [
      "Predicción de demanda de productos por departamento",
      "Detección de anomalías en patrones de gasto",
      "Automatización de asignación de centros de costo",
      "Optimización de tipos de cambio para compras internacionales"
    ],
    "data_quality_requirements": [
      "Normalización de descripciones de productos para mejor matching",
      "Validación de datos de proveedores para scoring preciso",
      "Estandarización de categorías de productos entre ERPs",
      "Limpieza de datos históricos para entrenamiento de modelos"
    ]
  }
}
